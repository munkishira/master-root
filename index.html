<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE MASTER ROOT - ETH Live Terminal</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; color: #f8fafc; font-family: 'JetBrains Mono', monospace; }
        #chart { width: 100%; height: 65vh; border: 1px solid #1e293b; }
        .neon-text { text-shadow: 0 0 10px rgba(0, 255, 204, 0.5); }
        .panel { background: rgba(15, 23, 42, 0.8); border: 1px solid #1e293b; backdrop-filter: blur(10px); }
    </style>
</head>
<body class="p-2 md:p-4">

    <div class="max-w-7xl mx-auto">
        <div class="panel p-4 mb-3 flex justify-between items-center rounded-2xl border-b-2 border-cyan-500">
            <div>
                <h1 class="text-2xl font-black tracking-tighter neon-text italic">THE MASTER ROOT <span class="text-cyan-400 font-normal not-italic text-sm">ETH/USDT</span></h1>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">Sincronizzazione Radici Blockchain Attiva</p>
            </div>
            <div class="text-right">
                <div id="statusLabel" class="text-xs font-bold px-3 py-1 rounded-full bg-slate-800 text-slate-400">CONNESSIONE...</div>
            </div>
        </div>

        <div id="chart" class="rounded-3xl overflow-hidden mb-4 shadow-2xl shadow-cyan-950/20"></div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
            <div class="panel p-4 rounded-2xl text-center">
                <p class="text-[10px] text-slate-500 uppercase mb-1">Distanza Root/Swap</p>
                <p id="distText" class="text-xl font-bold">--%</p>
            </div>
            <div class="panel p-4 rounded-2xl text-center">
                <p class="text-[10px] text-slate-500 uppercase mb-1">Profitto Balene ETH</p>
                <p id="profText" class="text-xl font-bold text-cyan-400">--%</p>
            </div>
            <div class="panel p-4 rounded-2xl text-center border-l-4 border-orange-500">
                <p class="text-[10px] text-slate-500 uppercase mb-1">Prezzo ETH</p>
                <p id="livePrice" class="text-xl font-bold text-white">--</p>
            </div>
            <div class="panel p-4 rounded-2xl text-center">
                <p class="text-[10px] text-slate-500 uppercase mb-1">Stato Teoria</p>
                <p id="theoryState" class="text-sm font-black uppercase text-yellow-500">Analisi...</p>
            </div>
        </div>
    </div>

    <script>
        // Configurazione Grafico
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { backgroundColor: 'transparent', textColor: '#94a3b8', fontSize: 12 },
            grid: { vertLines: { color: '#0f172a' }, horzLines: { color: '#0f172a' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { borderColor: '#1e293b', timeVisible: true },
        });

        const candleSeries = chart.addCandlestickSeries({ upColor: '#00ffcc', downColor: '#ff4444', borderVisible: false });
        const currentRootLine = chart.addLineSeries({ color: '#22d3ee', lineWidth: 3, title: 'Radice Attuale' });
        const pastRootLine = chart.addLineSeries({ color: '#f97316', lineWidth: 2, lineStyle: 2, title: 'LiquiditÃ  Passata' });

        // Funzione per recuperare dati reali da Binance (Gratis)
        async function fetchETHData() {
            try {
                const response = await fetch('https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1h&limit=200');
                const rawData = await response.json();
                
                const formattedData = rawData.map(d => ({
                    time: d[0] / 1000,
                    open: parseFloat(d[1]),
                    high: parseFloat(d[2]),
                    low: parseFloat(d[3]),
                    close: parseFloat(d[4])
                }));

                candleSeries.setData(formattedData);

                // Calcolo Logica delle Radici (Media Mobile basata su volumi pesanti)
                const rootData = formattedData.map((d, i) => {
                    const avg = formattedData.slice(Math.max(0, i-20), i+1).reduce((acc, curr) => acc + curr.close, 0) / (i < 20 ? i+1 : 21);
                    return { time: d.time, value: avg };
                });

                const liquidityData = rootData.map(d => ({ time: d.time, value: d.value * 0.96 }));

                currentRootLine.setData(rootData);
                pastRootLine.setData(liquidityData);

                // Update UI
                const lastPrice = formattedData[formattedData.length - 1].close;
                const lastRoot = rootData[rootData.length - 1].value;
                const lastLiq = liquidityData[liquidityData.length - 1].value;
                
                const dist = (((lastRoot - lastLiq) / lastLiq) * 100).toFixed(2);
                const prof = (((lastPrice - lastRoot) / lastRoot) * 100).toFixed(2);

                document.getElementById('livePrice').innerText = "$" + lastPrice.toFixed(2);
                document.getElementById('distText').innerText = dist + "%";
                document.getElementById('profText').innerText = prof + "%";
                document.getElementById('statusLabel').innerText = "LIVE SYNC: OK";
                document.getElementById('statusLabel').classList.replace('text-slate-400', 'text-green-400');

                let state = "ACCUMULO";
                if (prof > 15) state = "ZONA PROFITTO";
                if (Math.abs(dist) < 2) state = "SWAP IMMINENTE";
                document.getElementById('theoryState').innerText = state;

            } catch (error) {
                console.error("Errore dati:", error);
                document.getElementById('statusLabel').innerText = "ERRORE API";
            }
        }

        fetchETHData();
        setInterval(fetchETHData, 30000); // Aggiorna ogni 30 secondi
    </script>
</body>
</html>
