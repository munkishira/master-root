<!DOCTYPE html>
<html>
<head>
    <title>MASTER ROOT - ULTRA TERMINAL</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; }
        #controls { padding: 10px; border-bottom: 1px solid #333; display: flex; gap: 20px; }
        #chart { width: 100vw; height: 85vh; }
        .stat { color: #00ffcc; font-weight: bold; }
    </style>
</head>
<body>
    <div id="controls">
        <span>ASSET: <b class="stat">ETH/USDT</b></span>
        <span>STATUS: <b id="status" class="stat">CONNECTING...</b></span>
        <span>RADICE: <b id="rootVal" class="stat">--</b></span>
    </div>
    <div id="chart"></div>

    <script>
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { background: { color: '#000' }, textColor: '#0f0' },
            grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } },
            timeScale: { timeVisible: true, secondsVisible: true }
        });

        const candleSeries = chart.addCandlestickSeries({ upColor: '#0f0', downColor: '#f00' });
        const rootLine = chart.addLineSeries({ color: '#00ccff', lineWidth: 2 });
        
        // DATI REAL TIME VIA WEBSOCKET DIRETTO
        const socket = new WebSocket('wss://stream.binance.com:443/ws/ethusdt@kline_1s');

        let prices = [];
        let volumes = [];

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const k = data.k;
            const candle = {
                time: k.t / 1000,
                open: parseFloat(k.o),
                high: parseFloat(k.h),
                low: parseFloat(k.l),
                close: parseFloat(k.c)
            };

            candleSeries.update(candle);
            document.getElementById('status').innerText = "LIVE - " + candle.close;

            // LOGICA MASTER ROOT ISTANTANEA
            const volUSD = parseFloat(k.v) * candle.close;
            if (volUSD > 10000) {
                prices.push(candle.close);
                if (prices.length > 50) prices.shift();
                const avgRoot = prices.reduce((a, b) => a + b, 0) / prices.length;
                rootLine.update({ time: candle.time, value: avgRoot });
                document.getElementById('rootVal').innerText = avgRoot.toFixed(2);
            }
        };
    </script>
</body>
</html>
